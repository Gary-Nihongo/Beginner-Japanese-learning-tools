<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nihongo Sprint Pro | æ—¥å¸¸æºé€š Ã— æ—…éŠæœƒè©± (PWA)</title>
<meta name="description" content="å¾é›¶åˆ°æ—¥å¸¸æºé€šèˆ‡æ—…éŠæœƒè©±ï¼šäº”åéŸ³ï¼ˆå«æ¿éŸ³/æ‹—éŸ³ï¼‰ã€ç”Ÿæ´»Ã—æ—…éŠæœƒè©±ã€éŒ„éŸ³è·Ÿè®€ã€æ¸¬é©—ã€æ¯æ—¥ç›®æ¨™ã€‚">
<meta name="theme-color" content="#0b0f14">
<link rel="manifest" href="manifest.webmanifest">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<link rel="icon" href="icons/icon-192.png" sizes="192x192">
<link rel="icon" href="icons/icon-512.png" sizes="512x512">
<style>
  :root{--bg:#0b0f14;--card:#10161dCC;--text:#e6edf3;--muted:#94a3b8;--primary:#00e5a8;--accent:#7c4dff;--danger:#ff4d6d;--ok:#22c55e;--shadow:0 10px 30px rgba(0,0,0,.35);--radius:16px}
  @media(prefers-color-scheme:light){:root{--bg:#f6f7fb;--card:#ffffffee;--text:#0b0f14;--muted:#475569;--shadow:0 10px 24px rgba(0,0,0,.08)}}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans TC,PingFang TC,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;color:var(--text);
    background:radial-gradient(1200px 800px at 80% -10%,rgba(124,77,255,.25),transparent 60%),radial-gradient(1200px 800px at -10% 120%,rgba(0,229,168,.2),transparent 60%),var(--bg);min-height:100dvh}
  header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(140%) blur(10px);background:linear-gradient(180deg,rgba(16,22,29,.8),rgba(16,22,29,.4),transparent);border-bottom:1px solid rgba(255,255,255,.06)}
  .wrap{max-width:1100px;margin:0 auto;padding:16px 20px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:36px;height:36px;border-radius:12px;background:conic-gradient(from 210deg,#7c4dff,#00e5a8);display:grid;place-items:center;color:#fff;font-weight:800;box-shadow:var(--shadow)}
  .grid{display:grid;gap:18px}
  @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
  .hero{display:grid;gap:14px}.hero h2{margin:.2em 0;font-size:clamp(26px,2.6vw + 12px,40px)}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{padding:6px 10px;border-radius:999px;background:#0f172a;color:#cbd5e1;border:1px solid rgba(255,255,255,.1);font-size:12px}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  button{cursor:pointer;border:none;padding:12px 16px;border-radius:12px;font-weight:700;color:#0b0f14;background:linear-gradient(120deg,var(--primary),#7ef9d8);
    box-shadow:0 8px 24px rgba(0,229,168,.35);transition:transform .08s ease}
  button.secondary{background:#111827;color:#e5e7eb;border:1px solid rgba(255,255,255,.08);box-shadow:none}
  button:active{transform:translateY(1px)}
  .statbar{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
  .pill{background:#0f172a;color:#cbd5e1;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);display:flex;gap:8px;align-items:center}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .tab{padding:10px 12px;border-radius:10px;background:#0f172a;color:#cbd5e1;border:1px solid rgba(255,255,255,.1);cursor:pointer;font-weight:600}
  .tab.active{background:linear-gradient(120deg,rgba(124,77,255,.25),rgba(0,229,168,.25));color:#fff;border-color:transparent}
  .section{display:none}.section.active{display:block;animation:fade .25s ease}
  @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
  .fc{display:grid;gap:12px}
  .cardbig{display:grid;place-items:center;aspect-ratio:16/10;border-radius:20px;background:radial-gradient(120% 120% at 20% 10%,rgba(124,77,255,.22),transparent 50%),radial-gradient(120% 120% at 80% 90%,rgba(0,229,168,.22),transparent 50%),#0b1220;border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow);font-size:clamp(72px,9.5vw,120px);font-weight:900;color:white;user-select:none;position:relative;overflow:hidden}
  .cardbig small{position:absolute;bottom:10px;right:12px;color:#cbd5e1;font-size:14px;opacity:.8}
  .center{display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
  .choice{padding:12px 14px;border-radius:12px;background:#111827;color:#e5e7eb;border:1px solid rgba(255,255,255,.08);cursor:pointer;font-weight:700}
  .choice.correct{background:rgba(34,197,94,.2);border-color:#22c55e}
  .choice.wrong{background:rgba(255,77,109,.2);border-color:#ff4d6d}
  .prog{height:8px;background:#0f172a;border:1px solid rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
  .prog>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--primary))}
  .two{display:grid;gap:12px}
  @media(min-width:780px){.two{grid-template-columns:1fr 1fr}}
  .list{display:grid;gap:8px;max-height:320px;overflow:auto;padding-right:6px}
  .row{display:flex;justify-content:space-between;gap:8px;padding:10px 12px;border:1px dashed rgba(255,255,255,.12);border-radius:10px}
  .tiny{font-size:12px;opacity:.8}.micro{font-size:12px;color:var(--muted)}
  .success{color:var(--ok)}.danger{color:var(--danger)}
  .tagz{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .tag{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:#0f172a;color:#cbd5e1;cursor:pointer}
  .tag.active{border-color:transparent;background:linear-gradient(120deg,rgba(124,77,255,.25),rgba(0,229,168,.25));color:#fff}
  .footer{margin:40px 0 30px;color:var(--muted);text-align:center;font-size:13px}
</style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;align-items:center;gap:12px">
      <div class="brand"><div class="logo">ã‚</div><b>Nihongo Sprint Pro</b></div>
      <div class="pill" style="margin-left:auto"><input id="darkToggle" type="checkbox"> <label for="darkToggle" class="tiny">åˆ‡æ›æ·º/æ·±è‰²</label></div>
      <button class="secondary" id="installBtn" style="margin-left:8px;display:none">å®‰è£ App</button>
    </div>
  </header>

  <main class="wrap grid">
    <section class="card hero">
      <h2>ç›®æ¨™ï¼š<b>æ—¥å¸¸æºé€š</b>ï¼‹<b>æ—…éŠæœƒè©±</b> ğŸš€</h2>
      <div class="badges">
        <div class="badge">ğŸ§  äº”åéŸ³ï¼ˆå«æ¿éŸ³/æ‹—éŸ³ï¼‰</div>
        <div class="badge">ğŸ—£ï¸ ç”Ÿæ´» Ã— æ—…éŠæƒ…å¢ƒ</div>
        <div class="badge">ğŸ”Š TTSç™¼éŸ³ Ã— ğŸ™ï¸ è·Ÿè®€</div>
        <div class="badge">ğŸ“ˆ SRS Ã— æ¯æ—¥ç›®æ¨™</div>
      </div>
      <div class="controls">
        <button id="startQuick">é–‹å§‹å¿«é€Ÿèª²ç¨‹</button>
        <button class="secondary" id="resetBtn">é‡ç½®å­¸ç¿’è³‡æ–™</button>
      </div>
      <div class="statbar" id="stats">
        <div class="pill">â±ï¸ ä»Šæ—¥å­¸ç¿’ï¼š<b id="todayMins">0</b> åˆ†é˜</div>
        <div class="pill">ğŸ”¥ é€£å‹ï¼š<b id="streak">0</b> å¤©</div>
        <div class="pill">ğŸ ç›®æ¨™ï¼š<b id="goal">15</b> åˆ†é˜/å¤©</div>
      </div>
    </section>

    <section class="card">
      <div class="tabs" role="tablist">
        <div class="tab active" data-tab="kana">â‘  äº”åéŸ³è¨“ç·´</div>
        <div class="tab" data-tab="phrases">â‘¡ ç”Ÿæ´»ï¼æ—…éŠæœƒè©±</div>
        <div class="tab" data-tab="quiz">â‘¢ æ¸¬é©—æŒ‘æˆ°</div>
        <div class="tab" data-tab="progress">â‘£ é€²åº¦èˆ‡è¨­å®š</div>
      </div>

      <!-- Kana -->
      <div class="section active" id="kana">
        <div class="tagz" id="kanaPacks">
          <div class="tag active" data-pack="basic">åŸºç¤ 50 éŸ³</div>
          <div class="tag" data-pack="dakuten">æ¿éŸ³/åŠæ¿éŸ³ï¼ˆãŒ/ã–/ã /ã°/ã±ï¼‰</div>
          <div class="tag" data-pack="youon">æ‹—éŸ³ï¼ˆãã‚ƒ/ã—ã‚…/ã¡ã‚ƒ...ï¼‰</div>
          <div class="tag" data-pack="katakana">ç‰‡å‡åï¼ˆå¤–ä¾†èªï¼‰</div>
        </div>
        <div class="two">
          <div class="fc">
            <div class="prog"><div id="kanaProg"></div></div>
            <div class="cardbig" id="kanaCard" aria-live="polite">ã‚<small id="kanaHint">Hiragana</small></div>
            <div class="center" id="kanaChoices"></div>
            <div class="center">
              <button id="playKanaAudio" class="secondary">ğŸ”Š ç™¼éŸ³</button>
              <button id="toggleSet" class="secondary">åˆ‡æ›ï¼šå¹³/ç‰‡å‡å</button>
              <button id="showHint" class="secondary">æç¤º</button>
            </div>
            <div class="micro" id="kanaFeedback">é»é¸æ­£ç¢ºçš„ç¾…é¦¬éŸ³ã€‚</div>
          </div>
          <div class="card">
            <h3 style="margin-top:0">å­—åº«</h3>
            <div class="list" id="kanaList"></div>
            <p class="micro">âœ… ç¶ è‰²ï¼å·²ç†Ÿï¼›ç´…è‰²ï¼å¾…åŠ å¼·ï¼ˆä¾ä½ çš„ä½œç­”èˆ‡é–“éš”é‡è¤‡ï¼‰ã€‚</p>
          </div>
        </div>
      </div>

      <!-- Phrases -->
      <div class="section" id="phrases">
        <div class="tagz" id="phrasePacks">
          <div class="tag active" data-pack="daily">æ—¥å¸¸æºé€š</div>
          <div class="tag" data-pack="travel-stay">æ—…éŠï¼šä½å®¿</div>
          <div class="tag" data-pack="travel-dine">æ—…éŠï¼šé¤é£²</div>
          <div class="tag" data-pack="travel-transport">æ—…éŠï¼šäº¤é€š</div>
          <div class="tag" data-pack="travel-shopping">æ—…éŠï¼šè³¼ç‰©</div>
          <div class="tag" data-pack="emergency">ç·Šæ€¥ç‹€æ³</div>
        </div>
        <div class="two">
          <div class="card">
            <h3 style="margin-top:0">è·Ÿè®€ç·´ç¿’</h3>
            <p class="tiny">é»å¥å­å¯æ’­æ”¾ã€‚æŒ‰ã€ŒğŸ™ï¸ è·Ÿè®€ã€éŒ„éŸ³æ¯”å°ï¼ˆChrome/Android æ”¯æ´è¼ƒä½³ï¼‰ã€‚</p>
            <div class="list" id="phraseList"></div>
          </div>
          <div class="card">
            <h3 style="margin-top:0">å°æŠ„</h3>
            <ul class="list" id="cheats"></ul>
            <p class="micro">ğŸ’¡ åŠ©è©é™·é˜±ï¼š<span class="tiny"><b>ã¯</b>ï¼ˆä¸»é¡Œï¼‰å”¸ <b>wa</b>ï¼›<b>ã¸</b>ï¼ˆæ–¹å‘ï¼‰å”¸ <b>e</b>ï¼›<b>ã‚’</b>ï¼ˆå—è©ï¼‰å”¸ <b>o</b>ã€‚</span></p>
          </div>
        </div>
      </div>

      <!-- Quiz -->
      <div class="section" id="quiz">
        <div class="fc">
          <div class="prog"><div id="quizProg"></div></div>
          <div class="cardbig" id="quizPrompt">ã“ã‚“ã«ã¡ã¯</div>
          <div class="center">
            <input id="quizInput" placeholder="è¼¸å…¥ä¸­æ–‡æˆ–ç¾…é¦¬éŸ³ï¼ˆä¾‹ï¼škon'nichiwa / ä½ å¥½ï¼‰" style="padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.2);background:#0b1220;color:#fff;min-width:280px">
            <button id="quizCheck">é€å‡º</button>
            <button class="secondary" id="quizSpeak">ğŸ”Š æ’­æ”¾</button>
          </div>
          <div class="micro" id="quizFeedback">é¸æ“‡ä¸Šæ–¹çš„æœƒè©±åŒ… â†’ é–‹å§‹æ¸¬é©—ã€‚</div>
        </div>
      </div>

      <!-- Stats & Settings -->
      <div class="section" id="progress">
        <div class="two">
          <div class="card">
            <h3 style="margin-top:0">çµ±è¨ˆ</h3>
            <div class="list">
              <div class="row"><span>ä»Šæ—¥å­¸ç¿’åˆ†é˜</span><b id="statMins">0</b></div>
              <div class="row"><span>ä»Šæ—¥å®Œæˆé¡Œæ•¸</span><b id="statItems">0</b></div>
              <div class="row"><span>æœ€ä½³é€£å‹</span><b id="bestStreak">0</b></div>
              <div class="row"><span>äº”åéŸ³ç†Ÿæ‚‰ç‡</span><b id="kanaRate">0%</b></div>
              <div class="row"><span>æœƒè©±ç†Ÿæ‚‰ç‡</span><b id="phraseRate">0%</b></div>
            </div>
          </div>
          <div class="card">
            <h3 style="margin-top:0">è¨­å®š</h3>
            <div class="row"><span>æ¯æ—¥ç›®æ¨™ï¼ˆåˆ†é˜ï¼‰</span><input id="goalInput" type="number" min="5" max="60" step="5" value="15" style="width:100px"></div>
            <div class="row"><span>èªéŸ³èªè€…ï¼ˆVoiceï¼‰</span><select id="voiceSelect" style="min-width:180px"></select></div>
            <div class="row"><span>èªé€Ÿ</span><input id="rate" type="range" min="0.6" max="1.4" step="0.05" value="1"><span id="rateVal" class="tiny">1.00x</span></div>
            <div class="row"><span>æ¸…é™¤å…¨éƒ¨è³‡æ–™</span><button class="secondary" id="dangerReset">æˆ‘å¾ˆç¢ºå®š</button></div>
            <p class="micro">è³‡æ–™åƒ…å­˜æ–¼ä½ çš„è£ç½®ï¼ˆlocalStorageï¼‰ã€‚</p>
          </div>
        </div>
      </div>
    </section>
  </main>
  <div class="footer">Made for you with â¤ï¸ | Nihongo Sprint Pro â€” é›¶åŸºç¤åˆ°æ—…éŠæœƒè©±</div>

<script>
let deferredPrompt;
const installBtn = document.getElementById('installBtn');
window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; installBtn.style.display='inline-block'; });
installBtn?.addEventListener('click', async ()=>{ if(!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; installBtn.style.display='none'; });
if('serviceWorker' in navigator){ window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js')); }
</script>

<script>
// ====== Data (kana + phrase packs) ======
const HIRA_BASIC = [["ã‚","a"],["ã„","i"],["ã†","u"],["ãˆ","e"],["ãŠ","o"],
["ã‹","ka"],["ã","ki"],["ã","ku"],["ã‘","ke"],["ã“","ko"],
["ã•","sa"],["ã—","shi"],["ã™","su"],["ã›","se"],["ã","so"],
["ãŸ","ta"],["ã¡","chi"],["ã¤","tsu"],["ã¦","te"],["ã¨","to"],
["ãª","na"],["ã«","ni"],["ã¬","nu"],["ã­","ne"],["ã®","no"],
["ã¯","ha"],["ã²","hi"],["ãµ","fu"],["ã¸","he"],["ã»","ho"],
["ã¾","ma"],["ã¿","mi"],["ã‚€","mu"],["ã‚","me"],["ã‚‚","mo"],
["ã‚„","ya"],["ã‚†","yu"],["ã‚ˆ","yo"],
["ã‚‰","ra"],["ã‚Š","ri"],["ã‚‹","ru"],["ã‚Œ","re"],["ã‚","ro"],
["ã‚","wa"],["ã‚’","o(wo)"],["ã‚“","n"]];
const HIRA_DAKUTEN = [["ãŒ","ga"],["ã","gi"],["ã","gu"],["ã’","ge"],["ã”","go"],
["ã–","za"],["ã˜","ji"],["ãš","zu"],["ãœ","ze"],["ã","zo"],
["ã ","da"],["ã¢","ji(=di)"],["ã¥","zu(=du)"],["ã§","de"],["ã©","do"],
["ã°","ba"],["ã³","bi"],["ã¶","bu"],["ã¹","be"],["ã¼","bo"],
["ã±","pa"],["ã´","pi"],["ã·","pu"],["ãº","pe"],["ã½","po"]];
const HIRA_YOUON = [["ãã‚ƒ","kya"],["ãã‚…","kyu"],["ãã‚‡","kyo"],
["ã—ã‚ƒ","sha"],["ã—ã‚…","shu"],["ã—ã‚‡","sho"],
["ã¡ã‚ƒ","cha"],["ã¡ã‚…","chu"],["ã¡ã‚‡","cho"],
["ã«ã‚ƒ","nya"],["ã«ã‚…","nyu"],["ã«ã‚‡","nyo"],
["ã²ã‚ƒ","hya"],["ã²ã‚…","hyu"],["ã²ã‚‡","hyo"],
["ã¿ã‚ƒ","mya"],["ã¿ã‚…","myu"],["ã¿ã‚‡","myo"],
["ã‚Šã‚ƒ","rya"],["ã‚Šã‚…","ryu"],["ã‚Šã‚‡","ryo"],
["ãã‚ƒ","gya"],["ãã‚…","gyu"],["ãã‚‡","gyo"],
["ã˜ã‚ƒ","ja"],["ã˜ã‚…","ju"],["ã˜ã‚‡","jo"],
["ã³ã‚ƒ","bya"],["ã³ã‚…","byu"],["ã³ã‚‡","byo"],
["ã´ã‚ƒ","pya"],["ã´ã‚…","pyu"],["ã´ã‚‡","pyo"]];
const KATA_BASIC = [["ã‚¢","a"],["ã‚¤","i"],["ã‚¦","u"],["ã‚¨","e"],["ã‚ª","o"],
["ã‚«","ka"],["ã‚­","ki"],["ã‚¯","ku"],["ã‚±","ke"],["ã‚³","ko"],
["ã‚µ","sa"],["ã‚·","shi"],["ã‚¹","su"],["ã‚»","se"],["ã‚½","so"],
["ã‚¿","ta"],["ãƒ","chi"],["ãƒ„","tsu"],["ãƒ†","te"],["ãƒˆ","to"],
["ãƒŠ","na"],["ãƒ‹","ni"],["ãƒŒ","nu"],["ãƒ","ne"],["ãƒ","no"],
["ãƒ","ha"],["ãƒ’","hi"],["ãƒ•","fu"],["ãƒ˜","he"],["ãƒ›","ho"],
["ãƒ","ma"],["ãƒŸ","mi"],["ãƒ ","mu"],["ãƒ¡","me"],["ãƒ¢","mo"],
["ãƒ¤","ya"],["ãƒ¦","yu"],["ãƒ¨","yo"],
["ãƒ©","ra"],["ãƒª","ri"],["ãƒ«","ru"],["ãƒ¬","re"],["ãƒ­","ro"],
["ãƒ¯","wa"],["ãƒ²","o(wo)"],["ãƒ³","n"]];

const PACKS = {
  "daily":[
    {jp:"ã¯ã˜ã‚ã¾ã—ã¦ã€‚",romaji:"hajimemashite",zh:"åˆæ¬¡è¦‹é¢ã€‚"},
    {jp:"ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚",romaji:"yoroshiku onegai shimasu",zh:"è«‹å¤šæŒ‡æ•™ã€‚"},
    {jp:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚",romaji:"arigatou gozaimasu",zh:"éå¸¸æ„Ÿè¬ã€‚"},
    {jp:"ã™ã¿ã¾ã›ã‚“ã€‚",romaji:"sumimasen",zh:"ä¸å¥½æ„æ€/å°ä¸èµ·/å‹é§•ã€‚"},
    {jp:"ãŠé¡˜ã„ã—ã¾ã™ã€‚",romaji:"onegai shimasu",zh:"æ‹œè¨—æ‚¨/éº»ç…©æ‚¨ã€‚"},
    {jp:"ã‚‚ã†ä¸€åº¦ãŠé¡˜ã„ã—ã¾ã™ã€‚",romaji:"mou ichido onegai shimasu",zh:"è«‹å†èªªä¸€æ¬¡ã€‚"},
    {jp:"å¤§ä¸ˆå¤«ã§ã™ã€‚",romaji:"daijoubu desu",zh:"æ²’é—œä¿‚/æˆ‘å¯ä»¥ã€‚"},
    {jp:"ã‚†ã£ãã‚Šè©±ã—ã¦ãã ã•ã„ã€‚",romaji:"yukkuri hanashite kudasai",zh:"è«‹èªªæ…¢ä¸€é»ã€‚"},
    {jp:"æ—¥æœ¬èªã¯å°‘ã—ã ã‘è©±ã›ã¾ã™ã€‚",romaji:"nihongo wa sukoshi dake hanasemasu",zh:"æˆ‘åªæœƒèªªä¸€é»æ—¥æ–‡ã€‚"},
    {jp:"ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ã€‚",romaji:"toire wa doko desu ka",zh:"æ´—æ‰‹é–“åœ¨å“ªè£¡ï¼Ÿ"}
  ],
  "travel-stay":[
    {jp:"äºˆç´„ã—ã¦ã„ã¾ã™ã€ãƒ¤ãƒ³ã§ã™ã€‚",romaji:"yoyaku shite imasu, Yan desu",zh:"æˆ‘æœ‰é ç´„ï¼Œæˆ‘å§“æ¥Šã€‚"},
    {jp:"ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚",romaji:"chekku in wo onegai shimasu",zh:"æˆ‘è¦è¾¦ç†å…¥ä½ã€‚"},
    {jp:"ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’ãŠè¦‹ã›ã—ã¾ã™ã€‚",romaji:"pasupooto wo omise shimasu",zh:"çµ¦æ‚¨è­·ç…§ã€‚"},
    {jp:"è·ç‰©ã‚’é ã‹ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ã€‚",romaji:"nimotsu wo azukatte moraemasu ka",zh:"å¯ä»¥å¹«æˆ‘å¯„æ”¾è¡Œæå—ï¼Ÿ"},
    {jp:"æœé£Ÿã¯ä½•æ™‚ã‹ã‚‰ã§ã™ã‹ã€‚",romaji:"choushoku wa nanji kara desu ka",zh:"æ—©é¤å¹¾é»é–‹å§‹ï¼Ÿ"},
    {jp:"å»¶æ³Šã§ãã¾ã™ã‹ã€‚",romaji:"enpaku dekimasu ka",zh:"å¯ä»¥å»¶ä½å—ï¼Ÿ"},
    {jp:"ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã¯ä½•æ™‚ã§ã™ã‹ã€‚",romaji:"chekku auto wa nanji desu ka",zh:"é€€æˆ¿æ™‚é–“æ˜¯å¹¾é»ï¼Ÿ"}
  ],
  "travel-dine":[
    {jp:"ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ã€‚",romaji:"osusume wa nan desu ka",zh:"æ¨è–¦æ˜¯ä»€éº¼ï¼Ÿ"},
    {jp:"è‹±èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ã€‚",romaji:"eigo menyuu wa arimasu ka",zh:"æœ‰è‹±æ–‡èœå–®å—ï¼Ÿ"},
    {jp:"ã“ã‚Œã‚’äºŒã¤ãŠé¡˜ã„ã—ã¾ã™ã€‚",romaji:"kore wo futatsu onegai shimasu",zh:"é€™å€‹æˆ‘è¦å…©ä»½ã€‚"},
    {jp:"è¾›ãã—ãªã„ã§ãã ã•ã„ã€‚",romaji:"karaku shinaide kudasai",zh:"è«‹ä¸è¦å¤ªè¾£ã€‚"},
    {jp:"ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™ã€‚",romaji:"okaikei onegai shimasu",zh:"è«‹è²·å–®ã€‚"},
    {jp:"ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã§ãã¾ã™ã‹ã€‚",romaji:"teiku auto dekimasu ka",zh:"å¯ä»¥å¤–å¸¶å—ï¼Ÿ"}
  ],
  "travel-transport":[
    {jp:"å¤§é˜ªé§…ã¾ã§ã„ãã‚‰ã§ã™ã‹ã€‚",romaji:"oosaka eki made ikura desu ka",zh:"åˆ°å¤§é˜ªç«™å¤šå°‘éŒ¢ï¼Ÿ"},
    {jp:"ã“ã®é›»è»Šã¯é›£æ³¢ã¸è¡Œãã¾ã™ã‹ã€‚",romaji:"kono densha wa Namba e ikimasu ka",zh:"é€™ç­é›»è»Šæœ‰åˆ°é›£æ³¢å—ï¼Ÿ"},
    {jp:"ICã‚«ãƒ¼ãƒ‰ã¯ã©ã“ã§è²·ãˆã¾ã™ã‹ã€‚",romaji:"ai shii kaado wa doko de kaemasu ka",zh:"ICå¡åœ¨å“ªè²·ï¼Ÿ"},
    {jp:"ç©ºæ¸¯è¡Œãã¯ã©ã¡ã‚‰ã§ã™ã‹ã€‚",romaji:"kuukou yuki wa dochira desu ka",zh:"å¾€æ©Ÿå ´æ–¹å‘åœ¨å“ªï¼Ÿ"},
    {jp:"ã“ã“ã§é™ã‚Šã¾ã™ã€‚",romaji:"koko de orimasu",zh:"æˆ‘åœ¨é€™è£¡ä¸‹è»Šã€‚"},
    {jp:"é“ã«è¿·ã„ã¾ã—ãŸã€‚åŠ©ã‘ã¦ãã ã•ã„ã€‚",romaji:"michi ni mayoi mashita. tasukete kudasai",zh:"æˆ‘è¿·è·¯äº†ï¼Œè«‹å¹«å¿™ã€‚"},
    {jp:"åœ°å›³ã§æ•™ãˆã¦ãã ã•ã„ã€‚",romaji:"chizu de oshiete kudasai",zh:"å¯ä»¥ç”¨åœ°åœ–æŒ‡çµ¦æˆ‘çœ‹å—ï¼Ÿ"}
  ],
  "travel-shopping":[
    {jp:"ã„ãã‚‰ã§ã™ã‹ã€‚",romaji:"ikura desu ka",zh:"å¤šå°‘éŒ¢ï¼Ÿ"},
    {jp:"å…ç¨ã¯ã§ãã¾ã™ã‹ã€‚",romaji:"menzei wa dekimasu ka",zh:"å¯ä»¥å…ç¨…å—ï¼Ÿ"},
    {jp:"è©¦ç€ã§ãã¾ã™ã‹ã€‚",romaji:"shichaku dekimasu ka",zh:"å¯ä»¥è©¦ç©¿å—ï¼Ÿ"},
    {jp:"åˆ¥ã®ã‚µã‚¤ã‚ºã¯ã‚ã‚Šã¾ã™ã‹ã€‚",romaji:"betsu no saizu wa arimasu ka",zh:"æœ‰åˆ¥çš„å°ºå¯¸å—ï¼Ÿ"},
    {jp:"åŒã˜ã‚‚ã®ã‚’ã‚‚ã†ä¸€ã¤ã€‚",romaji:"onaji mono wo mou hitotsu",zh:"ä¸€æ¨£çš„å†ä¾†ä¸€å€‹ã€‚"},
    {jp:"ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã¯ä½¿ãˆã¾ã™ã‹ã€‚",romaji:"kurejitto kaado wa tsukaemasu ka",zh:"å¯ä»¥åˆ·å¡å—ï¼Ÿ"}
  ],
  "emergency":[
    {jp:"å…·åˆãŒæ‚ªã„ã§ã™ã€‚",romaji:"guai ga warui desu",zh:"æˆ‘èº«é«”ä¸èˆ’æœã€‚"},
    {jp:"ç—…é™¢ã¯ã©ã“ã§ã™ã‹ã€‚",romaji:"byouin wa doko desu ka",zh:"é†«é™¢åœ¨å“ªè£¡ï¼Ÿ"},
    {jp:"åŠ©ã‘ã¦ãã ã•ã„ã€‚",romaji:"tasukete kudasai",zh:"è«‹æ•‘æ•‘æˆ‘ã€‚"},
    {jp:"ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚",romaji:"arerugii ga arimasu",zh:"æˆ‘æœ‰éæ•ã€‚"},
    {jp:"ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’ãªãã—ã¾ã—ãŸã€‚",romaji:"pasupooto wo nakushimashita",zh:"æˆ‘æŠŠè­·ç…§å¼„ä¸Ÿäº†ã€‚"},
    {jp:"è­¦å¯Ÿã‚’å‘¼ã‚“ã§ãã ã•ã„ã€‚",romaji:"keisatsu wo yonde kudasai",zh:"è«‹å«è­¦å¯Ÿã€‚"}
  ]
};

// ====== Storage ======
const store = { load(){ return JSON.parse(localStorage.getItem("nihongo_sprint_pro") || "{}"); },
  save(s){ localStorage.setItem("nihongo_sprint_pro", JSON.stringify(s)); } };
let state = store.load();
if(!state.ver){ state = {ver:3,set:"HIRA",kanaPack:"basic",phrasePack:"daily",srs:{},minutesToday:0,lastTick:Date.now(),streak:0,best:0,itemsToday:0,goal:15}; store.save(state); }
function rollDay(){ const today=new Date().toDateString(); if(state.day!==today){ if(state.day){ const y=new Date(state.day); const diff=(new Date(today)-y)/86400000; if(diff===1 && state.minutesToday>=5){ state.streak=(state.streak||0)+1; } else if(diff>1){ state.streak=0; } state.best=Math.max(state.best||0,state.streak);} state.day=today; state.minutesToday=0; state.itemsToday=0; store.save(state);}}
rollDay(); setInterval(()=>{ state.minutesToday += 0.1/60; store.save(state); renderStats(); }, 100);

// ====== Helpers ======
const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];
const shuffle = a => { for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; };
function coins(n=12){ const box=document.createElement("div"); box.style.position="fixed"; box.style.inset="0"; box.style.pointerEvents="none"; for(let i=0;i<n;i++){ const s=document.createElement("div"); s.style.width=s.style.height=(6+Math.random()*8)+"px"; s.style.borderRadius="2px"; s.style.background=`hsl(${Math.random()*360},80%,60%)`; s.style.position="absolute"; s.style.left=Math.random()*100+"%"; s.style.top="-10px"; s.animate([{transform:`translateY(0) rotate(0deg)`},{transform:`translateY(${110+Math.random()*40}vh) rotate(${360+Math.random()*360}deg)`}],{duration:700+Math.random()*600,easing:"cubic-bezier(.2,.6,.2,1)",fill:"forwards"}); box.appendChild(s);} document.body.appendChild(box); setTimeout(()=>box.remove(),1200);}

// Tabs & UI
$$(".tab").forEach(t=> t.addEventListener("click",()=>{ $$(".tab").forEach(x=>x.classList.remove("active")); $$(".section").forEach(x=>x.classList.remove("active")); t.classList.add("active"); $("#"+t.dataset.tab).classList.add("active"); }));
$("#startQuick").addEventListener("click",()=>{ $$(".tab")[0].click(); coins(16); });
$("#resetBtn").addEventListener("click",()=>{ if(confirm("ç¢ºå®šé‡ç½®äº”åéŸ³é€²åº¦ï¼Ÿï¼ˆæœƒä¿ç•™æœƒè©±èˆ‡è¨­å®šï¼‰")){ Object.keys(state.srs).forEach(k=>{ if(k.startsWith("kana:")) delete state.srs[k]; }); store.save(state); renderKanaList(); coins(8);} });
$("#darkToggle").addEventListener("change",(e)=>{ document.documentElement.style.setProperty("--bg", e.target.checked? "#f6f7fb" : "#0b0f14"); });

// Kana trainer
let setName=state.set||"HIRA"; let kanaPack=state.kanaPack||"basic";
const packsMap = {basic:HIRA_BASIC,dakuten:HIRA_DAKUTEN,youon:HIRA_YOUON,katakana:KATA_BASIC};
const keyKana = ch => "kana:"+setName+":"+kanaPack+":"+ch;
function srsOf(k){ if(!state.srs[k]) state.srs[k]={ease:2.5,next:0,correct:0,wrong:0}; return state.srs[k]; }
function currentPool(){ let arr=packsMap[kanaPack]||HIRA_BASIC; if(setName==="KATA" && kanaPack!=="katakana") arr=KATA_BASIC; return arr; }
function renderKanaChoices(ans){ const wrap=$("#kanaChoices"); wrap.innerHTML=""; ans.forEach(t=>{ const b=document.createElement("button"); b.className="choice"; b.textContent=t; wrap.appendChild(b); }); }
function progressRate(list){ const now=Date.now(); const learned=list.filter(([ch])=>{ const s=srsOf(keyKana(ch)); return s.ease>2.6 && s.correct>=3 && s.next>now; }).length; return Math.round(learned/list.length*100); }
function renderProgress(sel,rate){ const bar=document.querySelector(sel); if(bar) bar.style.width=rate+"%"; }
function renderKanaList(){ const pool=currentPool(); const wrap=$("#kanaList"); wrap.innerHTML=""; pool.forEach(([ch,ro])=>{ const s=srsOf(keyKana(ch)); const rate=s.correct? Math.min(100, Math.round(s.correct/(s.correct+s.wrong)*100)) : 0; const row=document.createElement("div"); row.className="row"; row.innerHTML=`<div><b>${ch}</b> <span class="tiny">${ro}</span></div><div class="tiny ${rate>=70?'success':'danger'}">${rate}%</div>`; wrap.appendChild(row); }); $("#kanaRate").textContent = progressRate(pool)+"%"; }
function nextKana(){ const pool=currentPool(); const now=Date.now(); const due=pool.filter(([ch])=> (srsOf(keyKana(ch)).next||0)<=now ); const pick = (arr)=>arr[Math.floor(Math.random()*arr.length)]; const [kana,romaji] = pick(due.length? due: pool); }
</script>
</body>
</html>
